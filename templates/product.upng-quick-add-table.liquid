{% layout none %}

{% comment %}
  Tabla de variantes para selección rápida de productos en Shopify
  - La primera columna muestra el color con imagen
  - Las columnas siguientes representan las tallas disponibles
  - Cada celda permite añadir al carrito la variante seleccionada
{% endcomment %}

{% comment %} Debugging info {% endcomment %}
{% if product %}
  {% comment %} El producto existe {% endcomment %}
{% else %}
  <p>Error: No se encontró el objeto product</p>
{% endif %}

{% assign option1_name = product.options_with_values[0].name %}
{% assign option2_name = product.options_with_values[1].name %}

{% comment %} Usando options_with_values para obtener los valores de opciones de manera más confiable {% endcomment %}
{% assign option1_values = product.options_with_values[0].values %}
{% assign option2_values = product.options_with_values[1].values %}

<table class="quick-add-table">
  <thead>
    <tr>
      <th>{{ option1_name }}</th>
      {% for option2_value in option2_values %}
        <th>{{ option2_value }}</th>
      {% endfor %}
    </tr>
  </thead>
  <tbody>
    {% for option1_value in option1_values %}
      <tr>
        {% comment %} Primera celda con imagen del color {% endcomment %}
        <td class="variant-table__cell">
          {% assign first_variant_of_color = null %}
          {% for variant in product.variants %}
            {% if variant.option1 == option1_value %}
              {% assign first_variant_of_color = variant %}
              {% break %}
            {% endif %}
          {% endfor %}
          
          {% if first_variant_of_color.featured_image != blank %}
            {{
              first_variant_of_color.featured_image
              | image_url: width: 50
              | image_tag: class: 'variant-table__image', height: null, loading: 'lazy', alt: first_variant_of_color.title
            }}
          {% else %}
            {{
              product.featured_image
              | image_url: width: 50
              | image_tag: class: 'variant-table__image', height: null, loading: 'lazy', alt: product.title
            }}
          {% endif %}
        </td>
        
        {% comment %} Celdas para cada combinación de color/talla {% endcomment %}
        {% for option2_value in option2_values %}
          {% assign current_variant = null %}
          {% for variant in product.variants %}
            {% if variant.option1 == option1_value and variant.option2 == option2_value %}
              {% assign current_variant = variant %}
              {% break %}
            {% endif %}
          {% endfor %}
          
          <td class="variant-table__cell">
            {% if current_variant %}
              <button class="variant-select-button" 
                      data-variant-id="{{ current_variant.id }}"
                      {% unless current_variant.available %}disabled{% endunless %}>
                {% if current_variant.available %}
                  {{ current_variant.price | money }}
                {% else %}
                  Agotado
                {% endif %}
              </button>
            {% else %}
              <span class="variant-not-available">N/A</span>
            {% endif %}
          </td>
        {% endfor %}
      </tr>
    {% endfor %}
    
    {% comment %} LOGICA TOTALES TABLA {% endcomment %}
    <tr>
      <td colspan="3">
        <a
          class="cart-item__remove btn btn--icon text-current tap-target js-remove-item"
          href="#item.url_to_remove"
          data-index="item.index | plus: 1 "
          aria-label="{{- 'cart.items.remove' | t -}}"
        >
          {% render 'icon-trash' %}
          Borrar Todo
        </a>
      </td>
      <td colspan="2"><button class="btn btn-lg btn--secondary">Ver Cesta</button></td>
      <td colspan="2">Subtotal: <b>$$$$</b></td>
      <td colspan="1">Total Items: <b>29</b></td>
    </tr>
  </tbody>
</table>